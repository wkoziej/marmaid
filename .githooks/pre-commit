#!/bin/sh
# ABOUTME: Pre-commit hook that runs quality gates on staged files only
# ABOUTME: Prevents commits that would fail CI/CD by running same checks locally

# Change to frontend directory
cd "$(dirname "$0")/../" || exit 1

# Check if Node.js is available
if ! command -v node >/dev/null 2>&1; then
    echo "❌ Node.js is required but not installed. Please install Node.js."
    exit 1
fi

# Check if npm dependencies are installed
if [ ! -d "node_modules" ]; then
    echo "📦 Installing dependencies..."
    npm ci || {
        echo "❌ Failed to install dependencies"
        exit 1
    }
fi

# Run quality gates in pre-commit mode
echo "🔍 Running pre-commit quality gates..."
node scripts/quality-gates.js --pre-commit

# Exit with the same code as the quality gates script
exit $?